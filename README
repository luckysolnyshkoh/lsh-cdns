#SOF
#Updated: 2025112003

Программа представляет собой DNS Proxy Resolver.
Была написана для работы в yandex cloud, там есть проблема, связанная с тем, что ВМ из одного каталога
не могут резолвить например managed psql fqdn из другого каталога, а необходимость есть.
И стандартный механизм резолвинга даже если прописаны несколько ДНС серверов в ОС, работают только как fallback,
что приводит к невозможности разделения резолвинга разных fqdn и tld по разным ДНС серверам.

Эта программа написана именно для решения данной проблемы, и конечно может работать не только в ЯО :)

# Linux:
файл lsh-cdns это бинарник, можете его сами скомпилировать
go mod tidy ; go build .

Файл lsh-cdns.service копируем в /etc/systemd/system/
потом
systemctl enable lsh-cdns

сам каталог с прогой кладем в /opt/

после настроек можно
systemctl start lsh-cdns

# Windows:
go mod tidy
# Windows (консоль)
GOOS=windows GOARCH=amd64 go build -o lsh-cdns-console.exe .

# Windows (service)
GOOS=windows GOARCH=amd64 go build -tags windows -o lsh-cdns-svc.exe .
(я заметил что service версия как просто консольная тоже работает)

# Создание службы
sc create "lsh-cdns" binPath= "C:\путь\к\lsh-cdns-svc.exe --service" start= auto

# Запуск службы
sc start "lsh-cdns"
sc query "lsh-cdns"

################
### Настройки
main.env
Основные переменные

main.cfg
Указываются какие fqdn разрешать через какие DNS сервера. Имеют приоритет перед форвард-серверами.

main-domains.cfg
Аналогично предыдущему файлу, только здесь указываем tld которые надо резолвить через свои DNS сервера.

Сначала резолвятся из main.cfg, потом из main-domains.cfg, и уже потом фаллбэк-сервера.

#
Обратная связь ghub@luckysolnyshko.ru

#EOF
